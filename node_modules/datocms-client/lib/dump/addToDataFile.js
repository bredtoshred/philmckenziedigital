"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = addToDataFile;

var _writeFile = _interopRequireDefault(require("./writeFile"));

var _readFile = _interopRequireDefault(require("./readFile"));

var _serializeData = _interopRequireDefault(require("./serializeData"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function addToDataFile(file, format, data) {
  var oldContent, contentToAdd, newContent;
  return regeneratorRuntime.async(function addToDataFile$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return regeneratorRuntime.awrap((0, _readFile["default"])(file));

        case 2:
          _context.t0 = _context.sent;

          if (_context.t0) {
            _context.next = 5;
            break;
          }

          _context.t0 = '';

        case 5:
          oldContent = _context.t0;
          contentToAdd = (0, _serializeData["default"])(format, data);
          newContent = oldContent.replace(/\n*(#\s*datocms:start[\s\S]*#\s*datocms:end|$)/, "\n\n# datocms:start\n".concat(contentToAdd, "\n# datocms:end"));
          return _context.abrupt("return", (0, _writeFile["default"])(file, newContent));

        case 9:
        case "end":
          return _context.stop();
      }
    }
  });
}